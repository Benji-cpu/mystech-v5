<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ambient Background â€” MysTech Mock Lab</title>
  <link rel="stylesheet" href="../../shared/base.css">
  <link rel="stylesheet" href="../../shared/controls.css">
  <style>
    :root {
      --ctrl-density: 120;
      --ctrl-drift: 0.08;
      --ctrl-gradient-speed: 40s;
      --ctrl-nebula: 0.5;
      --ctrl-twinkle: 1;
      --ctrl-show-ui: 1;
    }

    body { overflow: hidden; }

    .bg-layers {
      position: fixed;
      inset: 0;
      z-index: 0;
    }

    /* Layer 1: Deep gradient base with hue rotation */
    .bg-gradient {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        #0a0118 0%,
        #110525 25%,
        #0d0320 50%,
        #1a0530 75%,
        #0a0118 100%
      );
      animation: gradient-rotate var(--ctrl-gradient-speed) linear infinite;
    }

    @keyframes gradient-rotate {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }

    /* Layer 2: Nebula aurora */
    .bg-nebula {
      position: absolute;
      inset: -20%;
    }

    .nebula-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      mix-blend-mode: screen;
    }

    .nebula-blob--1 {
      width: 50vw;
      height: 50vh;
      top: 10%;
      left: 5%;
      background: radial-gradient(ellipse, rgba(124, 77, 255, 0.25) 0%, transparent 70%);
      animation: nebula-drift-1 25s ease-in-out infinite alternate;
    }

    .nebula-blob--2 {
      width: 40vw;
      height: 40vh;
      top: 40%;
      right: 10%;
      background: radial-gradient(ellipse, rgba(201, 169, 78, 0.15) 0%, transparent 70%);
      animation: nebula-drift-2 30s ease-in-out infinite alternate;
    }

    .nebula-blob--3 {
      width: 35vw;
      height: 35vh;
      bottom: 10%;
      left: 30%;
      background: radial-gradient(ellipse, rgba(184, 138, 255, 0.18) 0%, transparent 70%);
      animation: nebula-drift-3 20s ease-in-out infinite alternate;
    }

    @keyframes nebula-drift-1 {
      0% { transform: translate(0, 0) scale(1); opacity: var(--ctrl-nebula); }
      100% { transform: translate(5vw, 3vh) scale(1.15); opacity: calc(var(--ctrl-nebula) * 0.7); }
    }
    @keyframes nebula-drift-2 {
      0% { transform: translate(0, 0) scale(1); opacity: calc(var(--ctrl-nebula) * 0.8); }
      100% { transform: translate(-4vw, -2vh) scale(1.1); opacity: var(--ctrl-nebula); }
    }
    @keyframes nebula-drift-3 {
      0% { transform: translate(0, 0) scale(1); opacity: calc(var(--ctrl-nebula) * 0.6); }
      100% { transform: translate(3vw, -4vh) scale(1.2); opacity: calc(var(--ctrl-nebula) * 0.9); }
    }

    /* Layer 3 & 4: Star field canvases */
    .star-canvas {
      position: absolute;
      inset: 0;
    }

    /* Layer 5: Sample UI overlay */
    .sample-ui {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      pointer-events: none;
      transition: opacity 400ms ease;
    }

    .sample-card {
      width: 14rem;
      aspect-ratio: 2/3;
      border-radius: 0.75rem;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(135deg, var(--bg-deep), var(--purple-dark), var(--bg-surface));
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6), 0 0 30px rgba(201, 169, 78, 0.08);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 1rem;
      pointer-events: auto;
    }

    .sample-card__title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.25rem;
    }

    .sample-card__subtitle {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* Header (on top of everything) */
    .mock-header { z-index: 100; }

    /* Control panel needs high z-index */
    .mock-controls { z-index: 200; }
  </style>
</head>
<body>
  <header class="mock-header">
    <a href="../../index.html" class="mock-back-link">Mock Lab</a>
    <h1 class="mock-title">Ambient Background</h1>
  </header>

  <div class="bg-layers">
    <!-- Layer 1: Gradient -->
    <div class="bg-gradient"></div>

    <!-- Layer 2: Nebula -->
    <div class="bg-nebula">
      <div class="nebula-blob nebula-blob--1"></div>
      <div class="nebula-blob nebula-blob--2"></div>
      <div class="nebula-blob nebula-blob--3"></div>
    </div>

    <!-- Layer 3: Distant stars -->
    <canvas id="starsDistant" class="star-canvas"></canvas>

    <!-- Layer 4: Near stars -->
    <canvas id="starsNear" class="star-canvas"></canvas>
  </div>

  <!-- Layer 5: Sample UI -->
  <div class="sample-ui" id="sampleUI">
    <div class="sample-card">
      <div class="sample-card__title">The Wanderer</div>
      <div class="sample-card__subtitle">Sample card for context</div>
    </div>
  </div>

  <script src="../../shared/controls.js"></script>
  <script>
    // ========== Star Field Renderer ==========

    class StarField {
      constructor(canvas, options = {}) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.stars = [];
        this.options = {
          count: options.count || 120,
          minSize: options.minSize || 0.5,
          maxSize: options.maxSize || 1.5,
          speed: options.speed || 0.08,
          twinkle: options.twinkle !== false,
          color: options.color || 'rgba(255, 255, 255, ',
          ...options,
        };
        this.animFrame = null;
        this.resize();
        this.init();
        window.addEventListener('resize', () => this.resize());
      }

      resize() {
        const dpr = window.devicePixelRatio || 1;
        this.canvas.width = window.innerWidth * dpr;
        this.canvas.height = window.innerHeight * dpr;
        this.canvas.style.width = window.innerWidth + 'px';
        this.canvas.style.height = window.innerHeight + 'px';
        this.ctx.scale(dpr, dpr);
        this.width = window.innerWidth;
        this.height = window.innerHeight;
      }

      init() {
        this.stars = [];
        for (let i = 0; i < this.options.count; i++) {
          this.stars.push(this.createStar());
        }
      }

      createStar(x, y) {
        return {
          x: x !== undefined ? x : Math.random() * this.width,
          y: y !== undefined ? y : Math.random() * this.height,
          size: this.options.minSize + Math.random() * (this.options.maxSize - this.options.minSize),
          baseOpacity: 0.3 + Math.random() * 0.7,
          twinklePhase: Math.random() * Math.PI * 2,
          twinkleSpeed: 0.5 + Math.random() * 2,
          dx: (Math.random() - 0.5) * 0.3,
          dy: -0.1 - Math.random() * 0.3, // drift upward
        };
      }

      update(speed, twinkleEnabled, time) {
        const dpr = window.devicePixelRatio || 1;
        this.ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        this.ctx.clearRect(0, 0, this.width, this.height);

        for (const star of this.stars) {
          // Move
          star.x += star.dx * speed;
          star.y += star.dy * speed;

          // Wrap
          if (star.x < -5) star.x = this.width + 5;
          if (star.x > this.width + 5) star.x = -5;
          if (star.y < -5) { star.y = this.height + 5; star.x = Math.random() * this.width; }
          if (star.y > this.height + 5) { star.y = -5; star.x = Math.random() * this.width; }

          // Twinkle
          let opacity = star.baseOpacity;
          if (twinkleEnabled) {
            opacity *= 0.5 + 0.5 * Math.sin(time * star.twinkleSpeed + star.twinklePhase);
          }

          this.ctx.beginPath();
          this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
          this.ctx.fillStyle = this.options.color + Math.max(0, Math.min(1, opacity)) + ')';
          this.ctx.fill();
        }
      }

      setCount(count) {
        while (this.stars.length < count) {
          this.stars.push(this.createStar());
        }
        while (this.stars.length > count) {
          this.stars.pop();
        }
      }
    }

    // ========== Init star fields ==========

    const distantField = new StarField(document.getElementById('starsDistant'), {
      count: 120,
      minSize: 0.3,
      maxSize: 1.0,
      color: 'rgba(255, 255, 255, ',
    });

    const nearField = new StarField(document.getElementById('starsNear'), {
      count: 30,
      minSize: 1.0,
      maxSize: 2.5,
      color: 'rgba(255, 255, 255, ',
    });

    // ========== Animation loop ==========

    let driftSpeed = 0.08;
    let twinkleEnabled = true;

    function animate(time) {
      const t = time * 0.001;
      distantField.update(driftSpeed * 0.5, twinkleEnabled, t);
      nearField.update(driftSpeed, twinkleEnabled, t);
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    // ========== Controls ==========

    const DENSITY_MAP = { '40': 40, '120': 120, '300': 300 };

    const controls = new MockControls('Ambient Background');

    controls.addSegmented('density', 'Star Density', [
      { label: 'Few',    value: '40' },
      { label: 'Medium', value: '120' },
      { label: 'Many',   value: '300' },
    ], (val) => {
      const count = parseInt(val);
      distantField.setCount(Math.round(count * 0.8));
      nearField.setCount(Math.round(count * 0.2));
    });

    controls.addSlider('drift', 'Drift Speed', {
      min: 0.01, max: 0.3, step: 0.01, default: 0.08, unit: ''
    }, (val) => {
      driftSpeed = val;
    });

    controls.addSegmented('gradient-speed', 'Gradient Speed', [
      { label: 'Slow',   value: '60s' },
      { label: 'Medium', value: '40s' },
      { label: 'Fast',   value: '15s' },
    ]);

    controls.addSlider('nebula', 'Nebula Intensity', {
      min: 0, max: 1, step: 0.05, default: 0.5, unit: ''
    });

    controls.addCheckbox('twinkle', 'Twinkle', true, (checked) => {
      twinkleEnabled = checked;
    });

    controls.addCheckbox('show-ui', 'Show Sample UI', true, (checked) => {
      document.getElementById('sampleUI').style.opacity = checked ? '1' : '0';
    });

    controls.render();
  </script>
</body>
</html>
